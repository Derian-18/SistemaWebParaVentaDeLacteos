{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Productos - Muuu y MÃ¡s</title>
    <link rel="stylesheet" href="{% static 'productos/lista.css' %}">
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar">
        <div class="logo-container">
            <div class="logo">ğŸ„</div>
            <div class="brand-text">
                <h1>Muuu y MÃ¡s</h1>
                <p>LÃ¡cteos Premium</p>
            </div>
        </div>

        <ul class="nav-links">
            <li><a href="{% url 'landingpage' %}">Inicio</a></li>
            <li><a href="{% url 'lista_productos' %}">Productos</a></li>
            <li><a href="{% url 'listar_categorias' %}">CategorÃ­as</a></li>

            {% if user.is_authenticated %}
            <li><a href="{% url 'logout' %}">Logout</a></li>
            {% else %}
            <li><a href="{% url 'login' %}">Login</a></li>
            {% endif %}
        </ul>

        <!-- BotÃ³n del carrito -->
        <button class="cart-btn" onclick="toggleCarrito()">ğŸ›’</button>
    </nav>

    <!-- Sidebar del Carrito -->
    <div id="sidebar-carrito">
        <div class="sidebar-header">
            <h2>ğŸ›’ Carrito</h2>
            <span class="close-btn" onclick="toggleCarrito()">âœ–</span>
        </div>

        <!-- LISTA DE ITEMS DEL CARRITO -->
        {% if carrito_items %}
            {% for item in carrito_items %}
                <div class="carrito-item">
                    <strong>{{ item.nombre }}</strong><br>
                    Cantidad: {{ item.cantidad }}<br>
                    Precio: ${{ item.producto.precio }}<br>
                    Subtotal: ${{ item.subtotal }}<br>

                    <a href="{% url 'actualizar_cantidadsidebar' item.id %}?accion=sumar">â•</a>
                    <a href="{% url 'actualizar_cantidadsidebar' item.id %}?accion=restar">â–</a>
                    <a href="{% url 'eliminar_itemsidebar' item.id %}">ğŸ—‘ï¸ Eliminar</a>
                </div>
            {% endfor %}
        {% else %}
            <p>Tu carrito estÃ¡ vacÃ­o ğŸ„ğŸ¥›</p>
        {% endif %}

        <div class="carrito-total">
            Total: ${{ carrito_total }}
        </div>

        <div class="carrito-actions">
            <a href="{% url 'vaciar_carrito' %}">Vaciar carrito</a><br>
            <a href="{% url 'ver_carrito' %}">Ir al carrito</a>
        </div>
    </div>

    <!-- SecciÃ³n de Productos -->
    <div class="container">
        <div class="header">
            <h1>Nuestros Productos</h1>
            <p>Descubre nuestra selecciÃ³n de productos lÃ¡cteos premium</p>
        </div>

        <!-- BotÃ³n de crear producto (solo admin) -->
        {% if user.is_authenticated and user.rol == "admin" %}
        <div class="admin-actions">
            <a href="{% url 'crear_producto' %}" class="btn-crear">â• Crear Producto</a>
        </div>
        {% endif %}

        <!-- Filtros por categorÃ­a (opcional - puedes agregar funcionalidad con JS) -->
        <div class="filter-tabs">
            <div class="tab active" onclick="filtrarCategoria('todas')">ğŸ¥› Todos</div>
            <div class="tab" onclick="filtrarCategoria('leche')">ğŸ¥› Leche</div>
            <div class="tab" onclick="filtrarCategoria('quesos')">ğŸ§€ Quesos</div>
            <div class="tab" onclick="filtrarCategoria('yogures')">ğŸ¦ Yogures</div>
            <div class="tab" onclick="filtrarCategoria('otros')">ğŸ¥¥ Otros</div>
        </div>

        <!-- Grid de productos -->
        <div class="products-grid">
            {% for producto in productos %}
            <div class="product-card" data-categoria="{{ producto.categoria.nombre|lower }}">
                <div style="position: relative;">
                    {% if producto.imagen %}
                        <img src="{{ producto.imagen.url }}" alt="{{ producto.nombre }}" class="product-image">
                    {% else %}
                        <div class="no-image">ğŸ„ Sin imagen</div>
                    {% endif %}
                    
                    <div class="stock-badge">Stock: {{ producto.stock }}</div>
                    <div class="favorite-btn">â™¡</div>
                </div>
                
                <div class="product-info">
                    <h3 class="product-title">{{ producto.nombre }}</h3>
                    <p class="product-description">{{ producto.categoria.nombre }} - {{ producto.unidad_medida }}</p>
                    
                    <div class="product-footer">
                        <span class="product-price">${{ producto.precio }}</span>
                        <a href="{% url 'agregar_al_carrito' producto.id %}" class="btn-add">
                            ğŸ›’ Agregar
                        </a>
                    </div>

                    <!-- Controles de administrador -->
                    {% if user.is_authenticated and user.rol == "admin" %}
                    <div class="admin-controls">
                        <a href="{% url 'editar_producto' producto.id %}" class="btn-edit">âœï¸ Editar</a>
                        <a href="{% url 'eliminar_producto' producto.id %}" class="btn-delete">ğŸ—‘ï¸ Eliminar</a>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <script>
        // Toggle del carrito
        function toggleCarrito() {
            let sidebar = document.getElementById("sidebar-carrito");
            sidebar.classList.toggle("open");
        }

        // Filtrado de productos por categorÃ­a (opcional)
        function filtrarCategoria(categoria) {
            // Actualizar tabs activos
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // Filtrar productos
            const productos = document.querySelectorAll('.product-card');
            productos.forEach(producto => {
                const productoCategoria = producto.getAttribute('data-categoria');
                
                if (categoria === 'todas') {
                    producto.style.display = 'block';
                } else {
                    if (productoCategoria.includes(categoria)) {
                        producto.style.display = 'block';
                    } else {
                        producto.style.display = 'none';
                    }
                }
            });
        }

        // AnimaciÃ³n de favoritos (opcional)
        document.addEventListener('DOMContentLoaded', function() {
            const favBtns = document.querySelectorAll('.favorite-btn');
            
            favBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    if (this.textContent === 'â™¡') {
                        this.textContent = 'â™¥';
                        this.style.color = '#f56565';
                    } else {
                        this.textContent = 'â™¡';
                        this.style.color = '#000';
                    }
                });
            });
        });
    </script>

</body>
</html>