{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Lista de Productos</title>
    <link rel="stylesheet" href="{% static 'productos/lista.css' %}">
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar">
        <div class="logo-container">
            <div class="logo">ğŸ„</div>
            <div class="brand-text">
                <h1>Muuu y MÃ¡s</h1>
                <p>LÃ¡cteos Premium</p>
            </div>
        </div>

        <ul class="nav-links">
            <li><a href="{% url 'landingpage' %}">Inicio</a></li>
            <li><a href="{% url 'lista_productos' %}">Productos</a></li>
            <li><a href="{% url 'listar_categorias' %}">Categorias</a></li>

            {% if user.is_authenticated %}
            <li><a href="{% url 'logout' %}">Logout</a></li>
            {% else %}
            <li><a href="{% url 'login' %}">Login</a></li>
            {% endif %}
        </ul>

        <!-- BotÃ³n del carrito -->
        <button class="cart-btn" onclick="toggleCarrito()">ğŸ›’</button>
    </nav>

    <!-- Sidebar del Carrito -->
    <div id="sidebar-carrito">
        <div class="sidebar-header">
            <h2>ğŸ›’ Carrito</h2>
            <span class="close-btn" onclick="toggleCarrito()">âœ–</span>
        </div>

        <!-- LISTA DE ITEMS DEL CARRITO -->
        {% if carrito_items %}
            {% for item in carrito_items %}
                <div class="carrito-item">
                    <strong>{{ item.nombre }}</strong><br>
                    Cantidad: {{ item.cantidad }}<br>
                    Precio: ${{ item.producto.precio }}<br>
                    Subtotal: ${{ item.subtotal }}<br>

                    <a href="{% url 'actualizar_cantidadsidebar' item.id %}?accion=sumar">â•</a>
                    <a href="{% url 'actualizar_cantidadsidebar' item.id %}?accion=restar">â–</a>
                    <a href="{% url 'eliminar_itemsidebar' item.id %}">ğŸ—‘ï¸ Eliminar</a>
                </div>
            {% endfor %}
        {% else %}
            <p>Tu carrito estÃ¡ vacÃ­o ğŸ„ğŸ¥›</p>
        {% endif %}

        <div class="carrito-total">
            Total: ${{ carrito_total }}
        </div>

        <div class="carrito-actions">
            <a href="{% url 'vaciar_carrito' %}">Vaciar carrito</a><br>
            <a href="{% url 'ver_carrito' %}">Ir al carrito</a>
        </div>
    </div>

    <!--Productos-->
<h1>Productos</h1>

{% if user.is_authenticated and user.rol == "admin" %}
<a href="{% url 'crear_producto' %}">â• Crear Producto</a>
{% endif %}

<table border="1">
    <tr>
        <th>Nombre</th>
        <th>Precio</th>
        <th>Stock</th>
        <th>Unidad</th>
        <th>CategorÃ­a</th>
        <th>Acciones</th>
        <th>Imagen</th>
    </tr>

    {% for producto in productos %}
    <tr>
        <td>{{ producto.nombre }}</td>
        <td>${{ producto.precio }}</td>
        <td>{{ producto.stock }}</td>
        <td>{{ producto.unidad_medida }}</td>
        <td>{{ producto.categoria.nombre }}</td>

        <td>
            {% if user.is_authenticated and user.rol == "admin" %}
                <a href="{% url 'editar_producto' producto.id %}">âœï¸ Editar</a>
                <a href="{% url 'eliminar_producto' producto.id %}">ğŸ—‘ï¸ Eliminar</a>
            {% endif %}

            <!-- BotÃ³n visible para cualquier usuario -->
            <a href="{% url 'agregar_al_carrito' producto.id %}" style="color: green;">
            ğŸ›’ Agregar al carrito
            </a>
        </td>

        <td>
            {% if producto.imagen %}
                <img src="{{ producto.imagen.url }}" width="80" height="80" style="object-fit: cover;">
            {% else %}
                <span>Sin imagen</span>
            {% endif %}
        </td>
    </tr>
    {% endfor %}
</table>

    <script>
        function toggleCarrito() {
            let sidebar = document.getElementById("sidebar-carrito");
            sidebar.classList.toggle("open");
        }
    </script>

</body>
</html>
